class Socket{ws;constructor(e,t){this.wsConnect(e,t)}setHandler(e,t){this.ws.on(e,t)}send(e,t){this.ws.emit(e,t)}wsConnect(e,t){"https:"==window.location.protocol?this.ws=io("wss://"+window.location.hostname+":"+window.location.port+window.location.pathname,{transports:["websocket"],path:"/socket.io",query:{}}):"http:"==window.location.protocol&&(this.ws=io("ws://"+window.location.hostname+":"+window.location.port+window.location.pathname,{transports:["websocket"],path:"/socket.io",query:{}})),this.ws.on("connect",()=>{console.log("connect:",this.ws),e&&e(this.ws)}),this.ws.on("disconnect",()=>{t&&t()}),window.WS=this.ws}getId(){return this.ws.id}}class Video{src=null;params=null;parentElement=null;video=null;constructor(e){e=Object.assign({},{selector:"body",width:320,height:240,id:0,name:"default",controls:!0,autoplay:!0,muted:!0},e);this.parentElement=document.querySelector(e.selector),this.video=document.createElement("video"),this.video.width=e.width,this.video.height=e.height,this.video.height=e.height,this.video.id=e.id||Math.ceil(1e6*Math.random()),this.video.controls=e.controls,this.video.autoplay=e.autoplay,this.video.muted=e.muted}attachStream(e){window.URL||window.webkitURL?this.video.srcObject=e:this.video.src=e}show(){this.parentElement.appendChild(this.video)}destroy(){this.video&&(this.parentElement.removeChild(this.video),this.video=null)}}class Media{devices;stream;screenStream;constructor(){this.devices={audio:[],video:[]},this.stream=null,this.screenStream=null}async getDevices(){try{var e=await navigator.mediaDevices.enumerateDevices();return e.filter(e=>"audioinput"===e.kind).forEach(e=>{this.devices.audio.push({...e.getCapabilities(),label:e.label})}),e.filter(e=>"videoinput"===e.kind).forEach(e=>{this.devices.video.push({...e.getCapabilities(),label:e.label})}),this.devices}catch(e){console.log(e)}}async getConstraints(){try{await this.getDevices();return{audio:0<this.devices.audio.length,video:0<this.devices.video.length}}catch(e){console.log(e)}}async getMediaStream(){try{this.stopTracks(this.stream);var e=await this.getConstraints(),t=await navigator.mediaDevices.getUserMedia(e);return this.stream=t}catch(e){console.log(e)}}async getUserMedia(e){return new Promise(function(t,s){navigator.getUserMedia(e,function(e){t(e)},function(e){s(e)})})}async getMediaStream2(){try{this.stopTracks(this.stream);var e=await this.getConstraints(),t=await this.getUserMedia(e);return this.stream=t}catch(e){console.log(e)}}stopTracks(e){e&&e.getTracks().forEach(e=>{e.stop()})}async getScreenStream(e){this.stopTracks(this.screenStream);var t=await this.getConstraints();let s=null;try{return navigator.mediaDevices.getDisplayMedia?s=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:t.audio}):navigator.getDisplayMedia&&(s=await navigator.getDisplayMedia({video:!0,audio:t.audio})),s&&(this.screenStream=s,this.addStreamStopListener(s,e)),s}catch(e){console.log(e)}}addStreamStopListener(e,t){e.addEventListener("ended",function(){t(),t=function(){}},!1),e.addEventListener("inactive",function(){t(),t=function(){}},!1),e.getTracks().forEach(function(e){e.addEventListener("ended",function(){t(),t=function(){}},!1),e.addEventListener("inactive",function(){t(),t=function(){}},!1)})}}const PeerConnection=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,IceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate,SessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription;navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;class WRTC{pc_config=null;app=null;pc_pool={};online=!1;chat_datachannel_pool={};file_datachannel_pool={};video_pool={};mash={};localStream=null;screenStream=null;constructor(e){this.app=e,this.chat_datachannel=null,this.file_datachannel=null,this.pc_config=e.ice}setIce(e){this.pc_config=e}setLocalStream(e){this.localStream=e}call(e){this.sendMessage({type:"intent_call"},e)}beginConnect(e){this.sendMessage({type:"call"},e);var t={that:this,username:e};this.mash[e]={},this.mash[e].pc=new PeerConnection(this.pc_config),this.mash[e].pc.onicecandidate=this.gotIceCandidate.bind(t),this.mash[e].pc.onaddstream=this.gotRemoteStream.bind(t),this.mash[e].pc.ontrack=this.gotRemoteTracks.bind(t),this.addStreamToRTCPeerConnection(this.localStream,e),this.mash[e].chat_datachannel=this.mash[e].pc.createDataChannel("chat",{negotiated:!0,id:0,ordered:!0}),this.mash[e].file_datachannel=this.mash[e].pc.createDataChannel("file",{negotiated:!0,id:1,ordered:!0}),this.mash[e].chat_datachannel.onopen=this.chatDataChannelOnOpen.bind(t),this.mash[e].chat_datachannel.onmessage=this.chatDataChannelOnMessage.bind(t),this.mash[e].file_datachannel.onopen=this.fileDataChannelOnOpen.bind(t),this.mash[e].file_datachannel.onmessage=this.fileDataChannelOnMessage.bind(t),this.mash[e].localDescription=!1,this.mash[e].online=!1}answer(e){console.log(Date.now(),"answer");var t={that:this,username:e};this.mash[e]={},this.mash[e].pc=new PeerConnection(this.pc_config),this.addStreamToRTCPeerConnection(this.localStream,e),this.mash[e].pc.onicecandidate=this.gotIceCandidate.bind(t),this.mash[e].pc.onaddstream=this.gotRemoteStream.bind(t),this.mash[e].pc.ontrack=this.gotRemoteTracks.bind(t),this.sendMessage({type:"offer_ready"},e),this.mash[e].chat_datachannel=this.mash[e].pc.createDataChannel("chat",{negotiated:!0,id:0,ordered:!0}),this.mash[e].file_datachannel=this.mash[e].pc.createDataChannel("file",{negotiated:!0,id:1,ordered:!0}),this.mash[e].chat_datachannel.onopen=this.chatDataChannelOnOpen.bind(t),this.mash[e].chat_datachannel.onmessage=this.chatDataChannelOnMessage.bind(t),this.mash[e].file_datachannel.onopen=this.fileDataChannelOnOpen.bind(t),this.mash[e].file_datachannel.onmessage=this.fileDataChannelOnMessage.bind(t),this.mash[e].localDescription=!1,this.mash[e].online=!1}createOffer(e){console.log(Date.now(),"createOffer"),this.mash[e].pc.createOffer(this.gotLocalDescription.bind({that:this,username:e}),function(e){console.log(e)},{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}})}createAnswer(e){console.log(Date.now(),"createAnswer"),console.log(Date.now(),"signalingState",this.mash[e].pc.signalingState),this.mash[e].pc.createAnswer(this.gotLocalDescription.bind({that:this,username:e}),function(e){console.log(e)},{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}})}gotLocalDescription(e){console.log(Date.now(),"gotLocalDescription:",e),this.that.mash[this.username].pc.setLocalDescription(e),this.that.sendMessage(e,this.username)}gotIceCandidate(e){console.log(Date.now(),"gotIceCandidate: ",e.candidate),e.candidate&&this.that.sendMessage({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate},this.username)}gotRemoteStream(e){console.log(Date.now(),"gotRemoteStream: ",e.stream),console.log(Date.now(),"gotRemoteStream(audio tracks): ",e.stream.getAudioTracks()),this.that.mash[this.username].online=!0,this.that.app.onRemoteStream(e.stream,this.username)}gotRemoteTracks(e){console.log(Date.now(),"gotRemoteTracks: ",e.streams),console.log(Date.now(),"gotRemoteTracks(audio tracks): ",e.streams[0].getAudioTracks()),this.that.mash[this.username].online=!0,this.that.app.onRemoteStream(e.streams[0],this.username)}sendMessage(e,t){console.log(Date.now(),"send_message: ",e,t),this.app.socket.send("wrtc_message",{message:e,to:t})}disconnect(e){void 0!==this.mash[e]&&this.mash[e]&&(this.mash[e].online&&(this.mash[e].online=!1),null!=this.mash[e].pc&&(this.mash[e].pc.close(),this.mash[e].pc=null,delete this.mash[e]),void 0!==this.mash[e]&&null!=this.mash[e].chat_datachannel&&(this.mash[e].chat_datachannel.close(),this.mash[e].chat_datachannel=null),void 0!==this.mash[e])&&null!=this.mash[e].file_datachannel&&(this.mash[e].file_datachannel.close(),this.mash[e].file_datachannel=null)}gotMessage(t){var s=t.message,t=t.from;if(console.log(Date.now(),"gotMessage: ",s,t),null!=this.mash[t]&&null!=this.mash[t].pc&&"offer"===s.type)this.mash[t].pc.setRemoteDescription(new SessionDescription(s)),this.createAnswer(t);else if(null!=this.mash[t]&&null!=this.mash[t].pc&&"answer"===s.type)this.mash[t].pc.setRemoteDescription(new SessionDescription(s));else if(null!=this.mash[t]&&null!=this.mash[t].pc&&"candidate"===s.type){var i=null;try{i=new IceCandidate(s),this.mash[t].pc.addIceCandidate(i)}catch(e){try{i=new IceCandidate({sdpMLineIndex:s.label,candidate:s.candidate}),this.mash[t].pc.addIceCandidate(i)}catch(e){console.log(e)}}}else"hangup"===s.type?(this.disconnect(),this.setHangUp(!1)):"call"===s.type?this.answer(t):"offer_ready"===s.type?this.createOffer(t):"intent_call"===s.type?this.sendMessage({type:"ready_call"},t):"ready_call"===s.type?this.beginConnect(t):"reject_call"===s.type&&(this.setSelectedUser(null),this.setHangUp(!1))}onGettingScreenSteam(e){this.screenStream=this.app.screenStream,Object.keys(this.mash).forEach(e=>{var t;e!==this.app.socket_id&&(this.removeStreamFromRTCPeerConnection(this.localStream,e),t=this.localStream.getAudioTracks(),console.log("audio tracks",t),0<t.length&&(console.log("add audio track",t[0]),this.screenStream.addTrack(t[0])),this.addStreamToRTCPeerConnection(this.screenStream,e),this.createOffer(e))})}onScreenShareEnded(){console.log("Screen share stopped"),Object.keys(this.mash).forEach(e=>{e!==this.app.socket_id&&(this.removeStreamFromRTCPeerConnection(this.screenStream,e),this.addStreamToRTCPeerConnection(this.app.stream,e),this.createOffer(e))})}addStreamToRTCPeerConnection(t,s){if(t)try{this.mash[s].pc.addStream(t)}catch(e){console.log("addStreamToRTCPeerConnection.stream:",t),t.getTracks().forEach(function(e){this.mash[s].pc.addTrack(e,t)})}}removeStreamFromRTCPeerConnection(s,i){if(s)try{this.mash[i].pc.removeStream(s)}catch(e){this.mash[i].pc.getSenders().forEach(function(t){s.getTracks().forEach(function(e){e==t.track&&this.mash[i].pc.removeTrack(t)})})}}videoOff(){this.localStream.getVideoTracks().forEach(function(e){e.enabled=!1}),Object.keys(this.mash).forEach(e=>{e!==this.app.socket_id&&this.createOffer(e)})}videoOn(){this.localStream.getVideoTracks().forEach(function(e){e.enabled=!0}),Object.keys(this.mash).forEach(e=>{e!==this.app.socket_id&&this.createOffer(e)})}audioOff(){this.localStream.getAudioTracks().forEach(function(e){e.enabled=!1}),Object.keys(this.mash).forEach(e=>{e!==this.app.socket_id&&this.createOffer(e)})}audioOn(){this.localStream.getAudioTracks().forEach(function(e){e.enabled=!0}),Object.keys(this.mash).forEach(e=>{e!==this.app.socket_id&&this.createOffer(e)})}chatDataChannelOnOpen(e){this.that.mash[this.username].chat_datachannel.send(["I'm connected","!"].join(" "))}chatDataChannelOnMessage(e){var t={created:(new Date).getTime(),from:this.username,to:this.that.app.socket_id,message:e.data},e={user:this.username,message:e.data};this.that.app.receiveChatMessage(e),console.log(t)}fileDataChannelOnOpen(e){console.log("file datachannel open")}fileDataChannelOnMessage(e){"string"==typeof e.data?this.that.app.filesp2p.startDownload(e.data):this.that.app.filesp2p.progressDownload(e.data)}sendChatMessage(t){console.log("send message p2p"),Object.keys(this.mash).forEach(e=>{e!==this.app.socket_id&&void 0!==this.mash[e]&&this.mash[e].chat_datachannel&&this.mash[e].chat_datachannel.send(t)})}sendFile(t,s){console.log("send file p2p"),Object.keys(this.mash).forEach(e=>{e!==this.app.socket_id&&void 0!==this.mash[e]&&this.mash[e].file_datachannel&&this.app.filesp2p.sendFile(t,this.mash[e].file_datachannel,s)})}}function sleep(t){return new Promise(e=>setTimeout(e,t))}Fp2p={BYTES_PER_CHUNK:12288,BUFFERED_AMOUNT_LIMIT:1e7,app:null,p2pConnection:null,incomingFiles:{},init:function(e){Fp2p.app=e},getFileObject:function(e,t){return{file:e,fileReader:new FileReader,p2pConnection:t,currentChunk:0,uuid:UUID4()}},sendFile:function(e,t,s){var i=Fp2p.getFileObject(e,t);i.fileReader.onload=function(){Fp2p.sendNextChunk(i)},i.progressbar=s,Fp2p.startUpload(i)},startDownload:function(e){"start"===(e=JSON.parse(e.toString())).type?(Fp2p.incomingFiles[e.uuid]={},Fp2p.incomingFiles[e.uuid].incomingFileInfo=e,Fp2p.incomingFiles[e.uuid].incomingFileData=[],Fp2p.incomingFiles[e.uuid].bytesReceived=0,Fp2p.incomingFiles[e.uuid].downloadInProgress=!0,console.log("incoming file <b>"+Fp2p.incomingFiles[e.uuid].incomingFileInfo.fileName+"</b> of "+Fp2p.incomingFiles[e.uuid].incomingFileInfo.fileSize+" bytes")):"end"===e.type&&Fp2p.endDownload(e.uuid)},progressDownload:function(e){var t,s,i;console.log(e),e.byteLength?(t=e.slice(36),s=(new TextDecoder).decode(new Int8Array(e.slice(0,36))),i=t.byteLength||t.size,Fp2p.incomingFiles[s].bytesReceived+=i,Fp2p.incomingFiles[s].incomingFileData.push(t),console.log(Fp2p.incomingFiles[s].bytesReceived),console.log(Fp2p.incomingFiles[s].incomingFileInfo.fileSize),console.log("progress: "+(Fp2p.incomingFiles[s].bytesReceived/Fp2p.incomingFiles[s].incomingFileInfo.fileSize*100).toFixed(2)+"%"),Fp2p.incomingFiles[s].bytesReceived===Fp2p.incomingFiles[s].incomingFileInfo.fileSize&&Fp2p.endDownload(s)):new Response(e).arrayBuffer().then(function(e){Fp2p.progressDownload(e)})},endDownload:function(e){var t,s;void 0===Fp2p.incomingFiles[e]||Fp2p.incomingFiles[e].bytesReceived<Fp2p.incomingFiles[e].incomingFileInfo.fileSize||(Fp2p.incomingFiles[e].downloadInProgress=!1,t=new window.Blob(Fp2p.incomingFiles[e].incomingFileData),(s=document.createElement("a")).innerHTML=Fp2p.incomingFiles[e].incomingFileInfo.fileName,s.href=URL.createObjectURL(t),s.download=Fp2p.incomingFiles[e].incomingFileInfo.fileName,Fp2p.app.appendIncomingFile(s),delete Fp2p.incomingFiles[e])},startUpload:function(e){console.log("sending "+e.file.name+" of "+e.file.size+" bytes"),e.currentChunk=0,e.p2pConnection.send(JSON.stringify({fileName:e.file.name,fileSize:e.file.size,uuid:e.uuid,type:"start"})),Fp2p.readNextChunk(e)},readNextChunk:async function(e){var t=Fp2p.BYTES_PER_CHUNK*e.currentChunk,s=Math.min(e.file.size,t+Fp2p.BYTES_PER_CHUNK);e.p2pConnection.bufferedAmount<Fp2p.BUFFERED_AMOUNT_LIMIT?e.fileReader.readAsArrayBuffer(e.file.slice(t,s)):(await sleep(30),Fp2p.readNextChunk(e))},sendNextChunk:function(e){var t=(new TextEncoder).encode(e.uuid),s=new Int8Array(e.fileReader.result),i=new Int8Array(s.length+t.length);i.set(t),i.set(s,t.length),e.p2pConnection.send(i.buffer),e.currentChunk++,Fp2p.BYTES_PER_CHUNK*e.currentChunk<e.file.size?(Fp2p.readNextChunk(e),s=Fp2p.BYTES_PER_CHUNK*e.currentChunk/e.file.size,s=parseInt(100*s),e.progressbar.innerText=s+"%",e.progressbar.textContent=s+"%",e.progressbar.style.width=s+"%"):(e.progressbar.innerText="Done",e.progressbar.textContent="Done",e.progressbar.style.width="100%",e.p2pConnection.send(JSON.stringify({uuid:e.uuid,type:"end"})),Fp2p.app.fileAccepted(e.file.name))}};class App{sendBtn=null;chatArea=null;messageArea=null;socket=null;media=null;video=null;stream=null;screenStream=null;socket_id=null;ice=null;wrtc=null;remoteVideos={};users=[];appear_users=[];disappear_users=[];video_off=!1;audio_off=!1;files=null;filesp2p=null;p2p_chat=!0;aliases={};constructor(){this.sendBtn=document.getElementById("send"),this.chatArea=document.getElementById("chat-area"),this.screenShareBtn=document.getElementById("screenshare"),this.videoToggleBtn=document.getElementById("videotoggle"),this.audioToggleBtn=document.getElementById("audiotoggle"),this.sendFileBtn=document.getElementById("sendfile"),this.fileInput=document.getElementById("file-input"),this.screenShareBtn.addEventListener("click",this.screenShare.bind(this)),this.videoToggleBtn.addEventListener("click",this.toggleVideo.bind(this)),this.audioToggleBtn.addEventListener("click",this.toggleAudio.bind(this)),this.sendFileBtn.addEventListener("click",this.sendFiles.bind(this)),this.exitBtn=document.getElementById("exit"),this.fileInput.addEventListener("change",this.onFilesSelected.bind(this)),this.messageArea=document.getElementById("message-area"),this.sendBtn.addEventListener("click",this.sendChatMessage.bind(this)),this.exitBtn.addEventListener("click",this.exit.bind(this)),this.aliasInput=document.getElementById("alias"),this.aliasInput.value=this.alias,this.aliasInput.addEventListener("change",this.onChangeAlias.bind(this)),this.wrtc=new WRTC(this),this.filesp2p=Fp2p,this.filesp2p.init(this),this.socket=new Socket(e=>{this.socket_id=e.id,console.log("socket_id:",this.socket_id),this.socket.setHandler("users",this.updateUsersList.bind(this)),this.socket.setHandler("message",this.receiveChatMessage.bind(this)),this.socket.setHandler("wrtc_message",this.wrtc.gotMessage.bind(this.wrtc)),this.socket.setHandler("aliases",this.onGotAliases.bind(this)),this.socket.send("alias",{alias:this.alias,socket_id:this.socket_id})},()=>{console.log("disconnect")}),this.getLocalMedia(),window.addEventListener("keypress",e=>{13===e.keyCode&&this.sendChatMessage()})}async getLocalMedia(){this.media=new Media;var e=await this.media.getConstraints(),e=(console.log("constraints:",e),await this.media.getDevices());console.log("devices:",e),this.stream=await this.media.getMediaStream(),console.log("stream:",this.stream),this.stream&&(this.video=new Video({selector:"div.video-container"}),this.video.show(),this.video.attachStream(this.stream)),this.wrtcConnect(this.stream)}async screenShare(){console.log("screenshare"),this.screenStream=await this.media.getScreenStream(this.onStopScreenShare.bind(this)),console.log("screenStream:",this.screenStream),this.screenStream&&(this.video.attachStream(this.screenStream),this.wrtc.onGettingScreenSteam(this.screenStream),this.diplay(this.screenShareBtn,!1))}async onStopScreenShare(){this.stream||(this.stream=await this.media.getMediaStream(),this.stream)?this.video.attachStream(this.stream):console.log("error onStopScreenShare"),this.wrtc.onScreenShareEnded(),this.diplay(this.screenShareBtn,!0)}sendChatMessage(){console.log(this.messageArea.value),this.messageArea.value.length&&(this.p2p_chat?this.wrtc.sendChatMessage(this.messageArea.value):this.socket.send("message",{message:this.messageArea.value}),this.receiveChatMessage({user:this.socket_id,message:this.messageArea.value}))}receiveChatMessage(e){console.log("resp: ",e);var t=(new Date).toLocaleString();let s=e.user;void 0!==this.aliases[s]&&this.aliases[s]&&(s=this.aliases[s]),this.chatArea.innerHTML+=`<span class="user">${s}</span>: ${e.message} <span class="date">${t}</span><br>`,this.messageArea.value=""}updateUsersList(t){console.log("updateUsersList: ",t);var s=document.querySelector("ul.users-list");this.destroyChildren(s);for(let e=0;e<t.sockets.length;e++){var i=document.createElement("li");i.innerHTML=t.sockets[e],t.sockets[e]===this.socket_id&&i.classList.add("me"),s.appendChild(i)}this.ice=t.ice,console.log("ice:",this.ice),this.wrtc&&this.wrtc.setIce(this.ice);let a=t.sockets;this.appear_users=a.filter(e=>-1===this.users.map(e=>e).indexOf(e)),this.disappear_users=this.users.filter(e=>-1===a.map(e=>e).indexOf(e)),this.users=t.sockets,this.wrtcConnect(this.stream)}async wrtcConnect(e){if(e){this.wrtc.setLocalStream(e);for(var t of this.appear_users)this.wrtc.call(t);for(var s of this.disappear_users)this.wrtc.disconnect(s),null!=this.remoteVideos[s]&&this.remoteVideos[s]&&(this.remoteVideos[s].destroy(),delete this.remoteVideos[s])}}destroyChildren(e){if(e)for(e.innerHTML="";e.firstChild;)e.removeChild(e.firstChild)}onRemoteStream(e,t){null!=this.remoteVideos[t]&&this.remoteVideos[t]&&(this.remoteVideos[t].destroy(),delete this.remoteVideos[t]),this.remoteVideos[t]=new Video({selector:"div.video-container",id:"video-"+t,name:t}),this.remoteVideos[t].show(),this.remoteVideos[t].attachStream(e),this.removeOldVideos()}removeOldVideos(){for(var e in this.remoteVideos)-1===this.users.indexOf(e)&&(this.remoteVideos[e].destroy(),delete this.remoteVideos[e])}diplay(e,t=!0){e&&(e.style.display=t?"inline-block":"none")}toggleVideo(){this.video_off=!this.video_off,console.log("toggle video",this.video_off),this.video_off?(this.videoToggleBtn.innerHTML='<i class="fa-solid fa-video"></i>',this.wrtc.videoOff()):(this.videoToggleBtn.innerHTML='<i class="fa-solid fa-video-slash"></i>',this.wrtc.videoOn())}toggleAudio(){this.audio_off=!this.audio_off,console.log("toggle audio",this.audio_off),this.audio_off?(this.audioToggleBtn.innerHTML='<i class="fa-solid fa-microphone-lines"></i>',this.wrtc.audioOff()):(this.audioToggleBtn.innerHTML='<i class="fa-solid fa-microphone-lines-slash"></i>',this.wrtc.audioOn())}sendFiles(){console.log("sendfiles"),this.fileInput.click()}onFilesSelected(){this.files=Array.from(this.fileInput.files),console.log("files selected",this.files);for(var e of this.files){var t=document.createElement("div"),s=(t.className="progress",document.createElement("div"));s.className="progress-bar",t.appendChild(s),this.chatArea.appendChild(t),s.className="progress-bar",this.wrtc.sendFile(e,s)}}appendIncomingFile(e){var t=document.createElement("div");t.id=UUID4(),t.appendChild(e),this.chatArea.appendChild(t)}fileAccepted(e){for(var t in this.files)this.files[t].name===e&&this.files.splice(t,1)}get alias(){return localStorage.getItem("alias")&&localStorage.getItem("alias").length?localStorage.getItem("alias"):null}set alias(e){e?localStorage.setItem("alias",e):localStorage.removeItem("alias")}onChangeAlias(){this.alias=this.aliasInput.value,this.socket.send("alias",{alias:this.alias,socket_id:this.socket_id})}onGotAliases(e){console.log("onGotAliases:",e);var t=e.aliases,s=(this.aliases=t,document.querySelectorAll("ul.users-list li"));for(let e=0;e<s.length;e++){var i=s[e].innerHTML;void 0!==t[i]&&t[i]&&(s[e].innerHTML=t[i])}var a=document.querySelectorAll("#chat-area span.user");for(let e=0;e<a.length;e++){var n=a[e].innerHTML;void 0!==t[n]&&t[n]&&(a[e].innerHTML=t[n])}}exit(){for(var e of this.users)this.wrtc.disconnect(e),null!=this.remoteVideos[e]&&this.remoteVideos[e]&&(this.remoteVideos[e].destroy(),delete this.remoteVideos[e]);window.location.href="/"}}const UUID4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})};function onLoad(){new App}window.addEventListener("load",onLoad);